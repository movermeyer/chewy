Что такое Chewy?
================
CHEWY расшифровывается как CMake Helpers Easy Way sYnchronizer. Chewy разработа как часть основанного на CMake
менеджера для C++/Python проектов. Эта утилита позволяет проверять версии CMake-модулей в Вашем проекте и
синхронизировать их с модулями из удаленного репозитория или нескольких, поддерживая тем самым их свежесть.
Таким образом Вы
всегда будете уверены, что во всех проектах одни и те же самые последние версии CMake-модулей.


Зачем все это?
==============
Если вы опытный разработчик, использующий в своем workflow билд-систему на основе CMake, то вам должна быть хорошо
знакома такая ситуация. Для очередного проекта вы пишете CMake-модуль (это может быть finder библиотеки или
просто разнообразные хелперы). А спустя какое-то время вы переносите этот модуль в
свежесозданный проект. Как результат, в какой-то момент вы обнаруживаете
множество разнообразных проектов с десятками не синхронизированных самописных CMake-модулей.
Свежие содержат новые версии, в проектах с более почтенным возрастом версии хотелось бы обновлять.

Хотя нередки и ситуации, когда мы возвращаемся к заброшенному годы назад проекту и, в порыве программерского
творчества, добавляем изменения и в его билд-систему, а позже понимаем, что столь гениальные находки просто
необходимо забрать в остальные проекты!..

В такие моменты в голове начинает формироваться некое смутное желание: вот бы держать все модули (аккуратно
отсортированными, классифицированными и снабженными бирочками) в собственном отдельном хранилище и
иметь возможность синхронизировать их в разных проектах! Пытливый программерский ум тут же подсказывает решение —
сложить все модули в отдельном репозитории под управлением любимой VSC и подключать его как внешний (external)
к репозиторию проекта. Но вот беда! Репозиторий содержит множество файлов, а в отдельном проекте нужны лишь
один-два-три из них! Не говоря уж про сложности работы с внешними репозиториями в распределенных системах
контроля версий. Короче говоря, лень побеждает. Энтропия в рабочей директории стремительно неубывает.
А на Рождество в письме Санте вы
пишете, что было бы здорово получить в подарок что-то вроде простого пакетного менеджера для управления
собственными cmake-модулями! Но в глубине души знаете, что ночью любимая супруга положит под елку очередной
полувер в клеточку…

Знакомая ситуация? Тогда знакомьтесь с нашим очаровательным лохматым (shaggy) вторым пилотом — Chewy!


Как это использовать?
=====================

`chewy` имеет всего 4 команды позволяющие просматривать содержимое удаленных _chewy_ репозитрориев,
устанавливать и обновлять из них модули.

Для просмотра сожержимого удаленного репозиторя можно воспользоваться командой

    $ chewy list [URL1 [... URLn]]

Результатом будет список доступных для установки модулей, их версий и описаний.
Если `URL` не был задан, `chewy` пытается угадать где в текущем проекте находятся CMake модули,
и ищет URL репозитория в уже установленных модулях.


Для добваления нового модуля нужно воспользоваться командой `get`

    $ chewy get file-URL1 [... file-URLn]

Для проверки доступных обновлений

    $ chewy status [file-URL ...]

Результатом этой команды будет вывод

    U|M filename local-version remote-version

где,

- **U** - есть более новая версия данного модуля
- **M** - локальная копия модуля имеет более новую версию

Если `file-URL` не задан, доступные обновления будут отображаться для всех использованных репозиториев.
Для получения обновлений установленных модулей

    $ chewy update [file-URL ...]

Если `file-URL` не задан, обновятся все модули, для которых есть более новые версии во всех используемых
репозиториях.


Как это работает?
=================

Работая над разнообразными проектами, количество CMake модулей, которые приходится писать
только пополняется. Время от времени их приходится копировать из проекта в проект, и затем следить,
чтобы изменения в модуле сделанные в одном проекте, попали во все остальные, при том, что, как уже
было сказано, в разных проектах испольузется разный набор этих модулей.
Опыт проекта [ac-archive](http://ac-archive.sourceforge.net/) показывает, что
в перспективе их может быть довольно значительное количество, кроме того, многие из них могли бы пригодиться
кому-то еще -- как правило новый модуль пишется после того, как не было найдено ничего подходящего среди
стандартных и через поисковые системы в других Open Source проектах. К сожалению ac-archive прошел
долгий путь от никому неизвестного проекта, до "известного в узких кругах", и еще более длинный путь до
того, как в некоторых дистрибутивах Linux появился пакет, обновляемый с выходом новой версии соответствующего
дистрибутива.

Поэтому Chewy задумывался как средство управления CMake модулями из репозиториев, чтобы в перспективе ;-)
не ждать дистромэйкеров и дать пользователям возможность быстро создавать свои репозитории и подключать
сторонние, созданные другими людьми. В целом, чем-то это похоже на оверлеи в Gentoo.

Итак, чтобы превратить обычный CMake модуль в _Chewy модуль_ нужно лишь добавить несколько комментариев
содержащих метаниформацию для `chewy`. Это всего лишь несколько полей, которые могут располагаться где
угодно в файле. В модулях нашего [репозитория](https://github.com/mutanabbi/chewy-cmake-rep) мы пишем
это в конце файла, т.е. начало файла традиционно содержит комментарии о том, как пользоваться модулем.
Итак, нужно вставить следующие поля:

- `X-Chewy-Repobase: URL`
    поле указывает на бфзовый URL репозитария. На данный момент поддерживается HTTP и HTTPS протоколы.
- `X-Chewy-Path: relative/path/to/Module.cmake`
    путь внутри репозитория к CMake модулю.
- `X-Chewy-Version: Major.Minor`
    версия модуля
- `X-Chewy-AddonFile: addon/file/path`
    путь к дополнительным файлам модуля. Как правило это тестовые программы, которые пытается собрать
    модуль, шаблоны файлов, используемые в вызовах `configure_file()`, в общем все, что может понадобится
    модулю для его работы. В отличии от предидущих полей, `X-Chewy-AddonFile` может быть указан несколько
    раз.

Для доступа к репозиторию `chewy` использует HTTP или HTTPS. Доступыне модули содержатся в файле индекса,
который должен находиться в корне и называться `manifest`. Это обычный текстовый файл, и для его создания
и/или обновления можно воспользоваться утилитой `chewy-update-manifest`. [GitHub](https://github.com)
вполне себе подходят для организации Chewy репозиториев: с одной стороны можно использовать `git`
для управления репозиторием, с другой стороны `chewy` по HTTPS может обновлять из него модули.



Ограничения
===========
1. [easy to fix harcode] расширение у модуля *.cmake
2. Файлы модулей должны иметь синтаксис, позволяющий игнорировать строки (комментарии), начинающиеся со знака # (для вставки X-Chewy-тегов)
3. центральное хранилище доступно по http[s]


Взгляд в более общий перспективе
================================

Вообще Chewy применим в случае, когда выполняются следующие условия:

1. Есть центральное хранилище
2. Центральное хранилище хранит множество "модулей"
3. [опционально] модули могут тащить за собой файлы-саттелиты
4. Модули необходимы для включения во множество локльных "проектов"
5. Изменения в модуле должны легко переноситься в проекты


> Chewy — лучший второй пилот на свете!
